toybox.ayatori-inc.co.jp {
	encode gzip

	# APIエンドポイント
	handle /api/* {
		reverse_proxy web:8000 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-For {remote_host}
			transport http {
				read_timeout 30s
				write_timeout 30s
			}
		}
	}

	# アップロードファイル（Django経由で配信）
	handle /uploads/* {
		reverse_proxy web:8000 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-For {remote_host}
			transport http {
				read_timeout 60s
				write_timeout 60s
			}
		}
	}

	# ファビコン
	handle /favicon.ico {
		reverse_proxy web:8000
	}

	# ヘルスチェック
	handle /health {
		reverse_proxy web:8000 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-For {remote_host}
		}
	}

	# SSOエンドポイント（タイムアウトを延長）
	handle /sso/* {
		reverse_proxy web:8000 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-For {remote_host}
			transport http {
				read_timeout 90s
				write_timeout 90s
			}
		}
	}

	# その他のリクエストはwebサービスに転送
	reverse_proxy web:8000 {
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-For {remote_host}
		transport http {
			read_timeout 30s
			write_timeout 30s
		}
	}
}
